import numpy as np
from scipy.signal import savgol_filter
from kneed import KneeLocator
import matplotlib.pyplot as plt


ignore_n =2
y = [0.26990383863449097, 0.21230757236480713, 0.022627711296081543, 0.0060160099528729916, 0.0031645805574953556, 0.00776500953361392, 0.0009428212069906294, 0.0009140475885942578, 7.847377128200606e-05, 7.847377128200606e-05, 0.0016527555417269468, 0.0012487652711570263, 0.00046828703489154577, 0.005139337852597237, 0.0010428008390590549, 0.002758313901722431, 0.0007717352127656341, 3.617508627939969e-05, 0.0010583795374259353, 6.036877675796859e-05, 0.0009699607035145164, 0.0002533025690354407, 0.001140853390097618, 0.0011483749840408564, 0.02894163504242897, 0.002582679269835353, 0.0011694587301462889, 0.0016466419911012053, 0.004995709750801325, 0.003469662042334676, 0.0027993135154247284, 0.004872005898505449, 0.0031984904780983925, 0.00656900554895401, 0.002517959102988243, 0.0008816713816486299, 0.0009673838503658772, 0.002784654265269637, 0.0011244906345382333, 0.0037107577081769705, 0.0005728286923840642, 0.0022126594558358192, 0.000945418025366962, 4.384404746815562e-05, 0.004871891811490059, 0.02413216419517994, 0.00022068370890337974, 0.0012689157156273723, 0.001713927136734128, 0.00019033736316487193, 0.00019033736316487193, 0.00019033736316487193, 0.00035056128399446607, 3.2842908694874495e-05, 0.00021895271493121982, 0.005310562904924154, 0.00021658273180946708, 0.0011230695527046919, 0.0001896629692055285, 0.0008225237834267318, 0.0003425842442084104, 0.0007604530546814203, 0.0016437557060271502, 0.00026381260249763727, 0.000257966632489115, 0.0013643630081787705, 6.314879283308983e-05, 0.0026825573295354843, 0.0006029118085280061, 0.00021345513232517987, 0.0006205033278092742, 0.0005556574324145913, 0.02731616050004959, 0.0035748062655329704, 0.00019908748799934983, 0.00022342539159581065, 0.00019908748799934983, 0.0025370882358402014, 0.00019908748799934983, 0.00022342539159581065, 0.00024408992612734437, 3.8488873542519286e-05, 0.00015395549417007715, 0.00015395549417007715, 0.004553832113742828, 0.001618675421923399, 0.00040466885548084974, 0.0001454549201298505, 0.0001489355490775779, 0.00014400309009943157, 0.00012166275701019913, 0.00012166275701019913, 0.00012166275701019913, 0.00012166275701019913, 0.0002847817086149007, 0.0001274109963560477, 4.414616705616936e-05, 6.77297284710221e-05, 0.000154081208165735, 0.005191531963646412, 0.00017875668709166348, 0.020990507677197456, 0.00038683111779391766, 0.0003222862724214792, 0.0003403823357075453, 0.0011081902775913477, 0.0005732083809562027, 0.0006050631054677069, 0.0003911806270480156, 0.0002739188203122467, 0.002209434751421213, 0.0001641697162995115, 0.0001641697162995115, 0.0001641697162995115, 0.0020051642786711454, 0.00025177342467941344, 0.002007409930229187, 0.0020266904029995203, 0.00010133451723959297, 0.00013406403013505042, 0.00010133451723959297, 0.024802429601550102, 0.001646786811761558, 0.00017875668709166348, 0.00042658584425225854, 0.0006621030042879283, 0.00019496289314702153, 0.001621465664356947, 0.00011368301784386858, 0.00017372846195939928, 0.0003032719832845032, 5.258419696474448e-05, 0.00032592914067208767, 0.0017438535578548908, 6.237158231670037e-05, 5.894692367292009e-05, 0.00251245335675776, 0.00013575443881563842, 0.00015701257507316768, 0.021666722372174263, 7.370680395979434e-05, 4.142179386690259e-05, 4.142179386690259e-05, 6.349321483867243e-05, 4.142179386690259e-05, 4.142179386690259e-05, 0.0019707807805389166, 7.77939785621129e-05, 7.77939785621129e-05, 7.77939785621129e-05, 3.957821900257841e-05, 0.0013506083050742745, 3.8959853554842994e-05, 0.00024727245909161866, 6.497724098153412e-05, 6.497724098153412e-05, 6.497724098153412e-05, 0.0015246018301695585, 4.573805563268252e-05, 4.573805563268252e-05, 0.00011021843238268048, 0.0002739188203122467, 0.0014748270623385906, 8.77094134921208e-05, 8.378452912438661e-05, 0.00017372846195939928]
# x = range(0, len(y))
x = np.arange(len(y) - ignore_n)

# print('x: ', len(x))
y = np.array(y)
idx_y = np.argsort(y)[::-1]

y = y[idx_y]

# print('y: ' ,len(y))

y = y[ignore_n:]
# print('new y: ' ,len(y))

print('len y: ', len(y))
half_length = 20 # int(len(y)/4)
if half_length % 2 == 0:
    window = half_length + 1
else:
    window = half_length

print('window size: ', window)

smoothed_y = savgol_filter(y, window, 1)

sensitivity = 1


kn = KneeLocator(x, y, curve='convex', direction='decreasing', S=sensitivity)
print('kn: ', kn.knee)

kn_smooth = KneeLocator(x, smoothed_y, curve='convex', direction='decreasing', S=sensitivity)
print('smoothed kn: ', kn_smooth.knee)


fig, (ax1, ax2) = plt.subplots(2)


ax2.set_xlabel('k')
ax2.set_ylabel('PageRank values')
ax2.plot(x, smoothed_y, 'rx-')
ax2.vlines(kn_smooth.knee, plt.ylim()[0], plt.ylim()[1], linestyles='dotted')

ax1.set_xlabel('k')
ax1.set_ylabel('PageRank values')
ax1.plot(x, y, 'bx-')
ax1.vlines(kn.knee, plt.ylim()[0], plt.ylim()[1], linestyles='dashed')



plt.show()
